<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Outlook ì¼€ì´ìŠ¤ íƒ€ì„ë¼ì¸ ë¶„ì„ê¸° (Pre-decode Base64)</title>

  <style>
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:#f3f4f6;
      color:#111;
    }
    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(90deg,#1e40af,#0f766e);
      color:#fff;padding:12px 20px;
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }
    .title{font-size:18px;font-weight:600}
    .subtitle{font-size:12px;opacity:.9}
    .file-box{
      display:flex;align-items:center;gap:8px;
      background:rgba(255,255,255,.2);padding:6px 12px;
      border-radius:999px;font-size:12px
    }
    main{display:flex;gap:16px;padding:16px}
    .sidebar{
      width:260px;background:#fff;border-radius:12px;padding:12px;
      height:calc(100vh - 70px);overflow:auto;
      box-shadow:0 2px 6px rgba(0,0,0,.08);font-size:12px;
    }
    .content{flex:1;height:calc(100vh - 70px);overflow:auto}
    .section-title{font-weight:600;font-size:13px;margin:8px 0}
    .small-btn{
      padding:6px 8px;border-radius:8px;border:1px solid #d1d5db;font-size:12px;
      background:#fff;cursor:pointer;width:100%
    }
    .small-btn:hover{background:#f3f4f6}
    #dropZone{
      border:2px dashed #9ca3af;background:#fff;padding:30px;
      border-radius:12px;text-align:center;font-size:13px;color:#6b7280;margin-bottom:12px
    }
    #dropZone.dragover{border-color:#2563eb;background:#eff6ff;color:#1d4ed8}
    .controls-row{display:flex;gap:8px;margin-bottom:10px}
    .search-input{
      flex:1;padding:6px 12px;border-radius:999px;border:1px solid #d1d5db;font-size:13px
    }
    @media(max-width:900px){
      main{flex-direction:column}
      .sidebar{width:100%;height:auto}
      .content{height:auto}
    }
  </style>
</head>
<body>

<header>
  <div>
    <div class="title">Outlook ì¼€ì´ìŠ¤ íƒ€ì„ë¼ì¸ ë¶„ì„ê¸°</div>
    <div class="subtitle">EML ì „ìš© Â· Pre-decode Base64 Â· í…ìŠ¤íŠ¸ ë·°ì–´</div>
  </div>
  <div class="file-box">
    <span>ğŸ“ EML íŒŒì¼ ì„ íƒ</span>
    <input id="fileInput" type="file" multiple accept=".eml" />
  </div>
</header>

<main>
  <aside class="sidebar">
    <div class="section-title">ì¼€ì´ìŠ¤ ê´€ë¦¬</div>
    <button id="btnAddCase" class="small-btn">â• ìƒˆ ì¼€ì´ìŠ¤</button>
    <div id="caseList" style="margin-top:10px"></div>
    <hr style="margin:16px 0">
    <div id="statsBox" style="font-size:12px;line-height:1.5;color:#444">
      GitHub í† í° ì…ë ¥ í›„ ì¼€ì´ìŠ¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.
    </div>
  </aside>

  <section class="content">
    <div id="dropZone">
      ì´ê³³ì— <b>.eml</b> íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ë†“ìœ¼ì„¸ìš”
    </div>

    <div class="controls-row">
      <input id="searchInput" class="search-input" placeholder="ì œëª© / ë³¸ë¬¸ / ë³´ë‚¸ì‚¬ëŒ / ë°›ëŠ”ì‚¬ëŒ ê²€ìƒ‰">
      <button id="btnClearSearch" class="small-btn">ì´ˆê¸°í™”</button>
    </div>

    <div id="viewInfo" style="font-size:12px;color:#444;margin-bottom:6px"></div>
    <div id="mailContainer"></div>
  </section>
</main>

<script type="module">
  import MimeParser from "https://esm.run/emailjs-mime-parser@2.0.6";
  
  function parseMime(raw) {
    const parser = new MimeParser();
    parser.write(raw);
    parser.end();
    return parser.node;
  }

  function fmtDate(d){
    if(!(d instanceof Date) || isNaN(d)) return "ë‚ ì§œ ì—†ìŒ";
    return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  }

  function esc(s){
    return String(s||"").replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));
  }

  async function handleFiles(files){
    if(!files.length) return;
    const file = files[0];
    if(file.name.split(".").pop().toLowerCase() !== "eml"){
      alert("EML íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }

    const reader = new FileReader();
    reader.onload = ev => {
      try{
        let raw = ev.target.result;
        const mail = parseEml(raw, file.name);
        renderEmail(mail);
      } catch(e) {
        console.error("EML íŒŒì‹± ì‹¤íŒ¨:", e);
      }
    };
    reader.readAsText(file, "utf-8");
  }

  function renderEmail(mail){
    const mc = document.getElementById("mailContainer");
    mc.innerHTML = `
      <div class="mail-card">
        <div class="mail-header">
          <div class="mail-meta">
            From: ${esc(mail.from.map(f=>f.email).join(", "))}<br>
            To: ${esc(mail.to.map(t=>t.email).join(", "))}
          </div>
          <div class="mail-date">${esc(fmtDate(mail.dateObj))}</div>
        </div>
        <div class="mail-body-preview">
          ${esc(mail.preview)}
        </div>
        <div class="mail-body-full">${esc(mail.body)}</div>
      </div>
    `;
  }

  document.getElementById("fileInput").onchange = (e) => handleFiles([...e.target.files]);

  window.ondragover = (e) => { 
    e.preventDefault(); 
    document.getElementById("dropZone").classList.add("dragover"); 
  };
  
  window.ondragleave = () => document.getElementById("dropZone").classList.remove("dragover");

  window.ondrop = (e) => {
    e.preventDefault(); 
    document.getElementById("dropZone").classList.remove("dragover");
    handleFiles([...e.dataTransfer.files]);
  };
</script>

</body>
</html>
